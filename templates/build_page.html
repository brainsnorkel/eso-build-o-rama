{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block meta_description %}{{ meta_description }}{% endblock %}

{% block content %}
<a href="index.html" class="back-link">← Back to All Builds</a>

<div class="card">
    <h2>{{ build.get_display_name() }}</h2>
    
    <div class="build-info">
        <div class="info-box">
            <div class="label">Trial &amp; Boss</div>
            <div class="value">{{ build.trial_name }} - {{ build.boss_name }}</div>
        </div>
        
        <div class="info-box">
            <div class="label">Popularity</div>
            <div class="value">{{ build.count }} top players using this build</div>
            <div class="status-indicator status-online"></div>
            <span style="font-size: 0.9em; color: #a8edea;">Active Build</span>
        </div>
        
        <div class="info-box">
            <div class="label">Update Version</div>
            <div class="value">{{ update_version }}</div>
            <div style="font-size: 0.8em; color: #a8edea; margin-top: 5px;">Current Meta</div>
        </div>
    </div>
</div>

<div class="card">
    <h3>Example Player</h3>
    <div class="build-info">
        <div class="info-box">
            <div class="label">Player</div>
            <div class="value">
                {{ best_player.player_name }} - {{ best_player.character_name }}
            </div>
        </div>
        
        <div class="info-box">
            <div class="label">DPS</div>
            <div class="value">{{ best_player.dps|format_dps }}</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ (best_player.dps / 150000 * 100) | round }}%"></div>
            </div>
        </div>
        
        <div class="info-box">
            <div class="label">Class</div>
            <div class="value">{{ best_player.class_name }}</div>
        </div>
        
        {% if best_player.mundus %}
        <div class="info-box">
            <div class="label">Mundus Stone</div>
            <div class="value">{{ best_player.mundus }}</div>
        </div>
        {% endif %}
    </div>
    
    <p style="margin-top: 15px;">
        <a href="{{ best_player.player_url }}" target="_blank" style="color: #3498db;">View on ESO Logs →</a>
    </p>
</div>

{% if best_player.abilities_bar1 or best_player.abilities_bar2 %}
<div class="card">
    <h3>Ability Bars</h3>
    
    {% if best_player.abilities_bar1 %}
    <h4 style="margin-top: 15px; color: #a8edea;">
        <span class="status-indicator status-online"></span>Bar 1 (Main) - 5 Abilities + Ultimate
    </h4>
    <div class="abilities-bar">
        {% for ability in best_player.abilities_bar1 %}
        <div class="ability tooltip" data-tooltip="{{ ability.ability_name }}{% if ability.skill_line %} - {{ ability.skill_line }}{% endif %}">
            {% if ability.ability_icon %}
            <img src="../static/icons/{{ ability.ability_icon }}.png" alt="{{ ability.ability_name }}" class="ability-icon">
            {% endif %}
            <div class="ability-name">{{ ability.ability_name or 'Empty' }}</div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if best_player.abilities_bar2 %}
    <h4 style="margin-top: 15px; color: #a8edea;">
        <span class="status-indicator status-online"></span>Bar 2 (Backup) - 5 Abilities + Ultimate
    </h4>
    <div class="abilities-bar">
        {% for ability in best_player.abilities_bar2 %}
        <div class="ability tooltip" data-tooltip="{{ ability.ability_name }}{% if ability.skill_line %} - {{ ability.skill_line }}{% endif %}">
            {% if ability.ability_icon %}
            <img src="../static/icons/{{ ability.ability_icon }}.png" alt="{{ ability.ability_name }}" class="ability-icon">
            {% endif %}
            <div class="ability-name">{{ ability.ability_name or 'Empty' }}</div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endif %}

{% if best_player.gear %}
<div class="card">
    <h3>Gear Setup</h3>
    
    <table>
        <thead>
            <tr>
                <th>Slot</th>
                <th>Set</th>
                <th>Item</th>
                <th>Trait</th>
                <th>Enchantment</th>
            </tr>
        </thead>
        <tbody>
            {% for gear in best_player.gear %}
            <tr>
                <td><strong>{{ gear.slot|title }}</strong></td>
                <td>{{ gear.set_name or 'N/A' }}</td>
                <td>{{ gear.item_name or 'N/A' }}</td>
                <td>{{ gear.trait or 'N/A' }}</td>
                <td>{{ gear.enchantment or 'N/A' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <h4 style="margin-top: 20px;">Set Summary</h4>
    <div class="build-info">
        {% for set_name, count in best_player.sets_equipped.items() %}
        <div class="info-box">
            <div class="label">{{ set_name }}</div>
            <div class="value">{{ count }} pieces</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if best_player.champion_points %}
<div class="card">
    <h3>Champion Points (Blue)</h3>
    <ul>
        {% for cp in best_player.champion_points %}
        <li>{{ cp }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% if build.all_players|length > 1 %}
<div class="card">
    <h3>Other Example Players ({{ build.all_players|length }} total)</h3>
    <table>
        <thead>
            <tr>
                <th>Player</th>
                <th>Character</th>
                <th>DPS</th>
                <th>Contribution</th>
            </tr>
        </thead>
        <tbody>
            {% for player in build.all_players[:10] %}
            <tr>
                <td>{{ player.player_name }}</td>
                <td>{{ player.character_name }}</td>
                <td>{{ player.dps|format_dps }}</td>
                <td>{{ player.dps_percentage|format_percentage }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% if build.all_players|length > 10 %}
    <p style="margin-top: 10px; color: #7f8c8d; font-style: italic;">
        Showing top 10 of {{ build.all_players|length }} players
    </p>
    {% endif %}
</div>
{% endif %}
{% endblock %}
