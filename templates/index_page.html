{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block meta_description %}{{ meta_description }}{% endblock %}

{% block content %}
<div class="card">
    <h2>Common builds from ranked reports{% if not update_version.startswith('unknown') %} - {{ update_version }}{% endif %}</h2>
    <p style="margin-top: 10px; color: #7f8c8d;">
        Analyzed from the top logs of each trial boss. Found <strong>{{ total_builds }}</strong> common builds (DPS: 5+ occurrences, Tank/Healer: 3+ occurrences).
    </p>
</div>

{% for trial_name, trial_data in builds_by_trial.items() %}
<div class="card">
    <h2>{{ trial_name }}
        {% if trial_data.metadata.last_updated %}
        <small style="font-size: 0.6em; color: #a8edea; font-weight: normal; margin-left: 15px;">
            Last updated: {{ trial_data.metadata.last_updated|format_timestamp }}
        </small>
        {% endif %}
    </h2>
    
    {% for boss_name, boss_data in trial_data.bosses.items() %}
    <h3>{{ boss_name }}</h3>
    
    <table>
        <thead>
            <tr>
                <th>Role</th>
                <th>Subclassing</th>
                <th>Signature Sets</th>
                <th>Frequency</th>
                <th>Top DPS</th>
                <th>Player</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for build in boss_data.builds %}
            <tr>
                <td data-label="Role">
                    {% set role_icon = '‚öîÔ∏è' if build.best_player.role == 'dps' else ('üõ°Ô∏è' if build.best_player.role == 'tank' else 'üíö') %}
                    <span title="{{ build.best_player.role.title() }}" aria-label="{{ build.best_player.role.title() }} role">{{ role_icon }}</span>
                </td>
                <td data-label="Build"><strong>{{ build.get_display_name() }}</strong></td>
                <td data-label="Sets">
                    {% set sorted_sets = build.get_sorted_sets() %}
                    {% if sorted_sets %}
                        {{ sorted_sets|join(', ') }}
                    {% else %}
                        Unknown Sets
                    {% endif %}
                </td>
                <td data-label="Popularity">{{ build.count }} in {{ boss_data.total_reports }} fight reports</td>
                <td data-label="Top DPS">{{ build.best_player.dps|format_dps }}</td>
                <td data-label="Player">{{ build.best_player.player_name }}</td>
                <td data-label="Details">
                    <a href="{{ update_version.lower() }}-{{ build.build_slug }}.html" style="color: #3498db;">
                        Build‚Üí
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endfor %}
</div>
{% endfor %}

<div class="card">
    <h3>About This Data</h3>
    <p style="line-height: 1.8;">
        This page shows the most frequently seen builds from the top 10 ranked esologs.com reports, for each boss, for each trial. 
        A build is listed here if it appears 5 or more times among players in these top ranked reports. 
        3 or more times for tank and healer builds. If there are no "common" builds for a boss or a trial (sorry vSO) then none will be shown.
    </p>
    <p style="margin-top: 10px; line-height: 1.8;">
        To this tool, a "build" is a unique combination of subclasses (skill lines), and two 5-piece gear sets.
    </p>
    <p style="margin-top: 10px; line-height: 1.8;">
        <strong>Data Source:</strong> ESO Logs public logged trial rankings. Reports are regenerated daily one trial at a time.
    </p>
</div>
{% endblock %}
